<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cjh.ttt.dao.UserDao">

  <!--通过主键删除-->
  <delete id="deleteById">
    delete
    from ttt.dict
    where id = #{id}
  </delete>

  <select id="selectByOpenId" resultType="com.cjh.ttt.entity.User">
    select *
    from user
    where data_level = 1
      and open_id = #{openId}
  </select>

  <select id="selectByPhone" resultType="com.cjh.ttt.entity.User">
    select *
    from user
    where data_level = 1
      and phone = #{phone}
  </select>

  <select id="selectByBirthday" resultType="com.cjh.ttt.entity.User">
    select *
    from user
    where data_level = 1
      and birthday = #{birthday}
  </select>

  <select id="selectBySexAndBirthday" resultType="com.cjh.ttt.entity.User">
    select tt.*
    from (
           select *
           from user
           where data_level = 1
             and sex = #{sex}
             and birthday = #{birthday}
            <if test="ids != null and ids.size() > 0">
              and id not in
              <foreach collection="ids" separator="," open="(" close=")" item="item">
                #{item}
              </foreach>
            </if>
           order by id
         ) tt
  </select>

  <select id="selectBySexAndNearByBirthday" resultType="com.cjh.ttt.entity.User">
    select tt.*
    from (
           select *
           from user
           where data_level = 1
             and (
               date_format(birthday, 'MM-dd') = date_format(#{birthday}, 'MM-dd')
               or
               to_days(birthday) between to_days(#{birthday}) - 365 and to_days(#{birthday}) + 365
             )
             and sex = #{sex}
            <if test="ids != null and ids.size() > 0">
              and id not in
              <foreach collection="ids" separator="," open="(" close=")" item="item">
                #{item}
              </foreach>
            </if>
         ) tt
  </select>

  <select id="selectByAddress" resultType="com.cjh.ttt.entity.User">
    select *
    from user
    where data_level = 1
    <if test="ids != null and ids.size() > 0">
      and id not in
      <foreach collection="ids" separator="," open="(" close=")" item="item">
        #{item}
      </foreach>
    </if>
  </select>

</mapper>